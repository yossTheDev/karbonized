"use strict";const o=require("electron"),l=require("fs"),x=require("node:fs/promises"),n=require("path");function u(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const a in t)if(a!=="default"){const p=Object.getOwnPropertyDescriptor(t,a);Object.defineProperty(e,a,p.get?p:{enumerable:!0,get:()=>t[a]})}}return e.default=t,Object.freeze(e)}const s=u(x),f=async t=>{l.mkdirSync(n.join(o.app.getPath("appData"),"karbonized","extensions"),{recursive:!0}),t.reply("loading_extensions",!0);const e=n.join(o.app.getPath("appData"),"karbonized","extensions"),a=(await s.readdir(e)).filter(async i=>(await s.stat(`${n.join(e,i)}`)).isDirectory()),p=[];for(const i of a){let r={logo:"",components:[]};console.log("loading extensions..."),l.existsSync(n.join(e,i,"logo.png"))&&(r.logo="data:image/png;base64,"+await s.readFile(n.join(e,i,"logo.png"),"base64")),r.info=JSON.parse(await s.readFile(n.join(e,i,"info.json"),"utf-8"));const g=(await s.readdir(n.join(e,i,"components"))).filter(m=>m.endsWith(".json"));for(const m of g){let d={};d.properties=JSON.parse(await s.readFile(n.join(e,i,"components",m),"utf-8"));const c=m.split(".")[0];l.existsSync(n.join(e,i,"components",c+".png"))&&(d.image="data:image/png;base64,"+await s.readFile(n.join(e,i,"components",c+".png"),"base64")),l.existsSync(n.join(e,i,"components",c+".svg"))&&(d.image=await s.readFile(n.join(e,i,"components",c+".svg"),"utf-8")),l.existsSync(n.join(e,i,"components",c+".jsx"))&&(d.code=await s.readFile(n.join(e,i,"components",c+".jsx"),"utf-8")),r.components.push(d)}p.push(r),console.log(r.info),t.reply("extension_loaded",r)}await s.writeFile(n.join(o.app.getPath("appData"),"karbonized","extensions_data.json"),JSON.stringify(p)),console.log("Loading Extensions... Finished"),t.reply("loading_extensions",!1)};o.app.whenReady().then(()=>{const t=o.nativeImage.createFromPath(n.join(__dirname,"assets",process.platform==="win32"?"icon.ico":"icon.png")),e=new o.BrowserWindow({title:"Karbonized",icon:t,width:800,height:600,minHeight:600,minWidth:900,useContentSize:!0,frame:process.platform==="darwin",titleBarStyle:"hidden",webPreferences:{preload:n.join(__dirname,"preload.js"),sandbox:!1}});process.env.VITE_DEV_SERVER_URL||(o.app.applicationMenu=new o.Menu),e.maximize(),process.env.VITE_DEV_SERVER_URL?e.loadURL(process.env.VITE_DEV_SERVER_URL):e.loadFile("dist/index.html"),o.ipcMain.on("maximizeApp",a=>{e.isMaximized()?(e.unmaximize(),a.reply("maximizedStatus",e.isMaximized())):(e.maximize(),a.reply("maximizedStatus",e.isMaximized()))}),o.ipcMain.on("minimizeApp",()=>{e.minimize()}),o.ipcMain.on("closeApp",()=>{e.close()}),o.ipcMain.on("getAppData",async a=>{await(async()=>{if(l.existsSync(n.join(o.app.getPath("appData"),"karbonized","extensions_data.json"))){const i=JSON.parse(await s.readFile(n.join(o.app.getPath("appData"),"karbonized","extensions_data.json"),"utf-8"));a.reply("extensions_loaded",i)}else await f(a)})()}),o.ipcMain.on("reloadExtensions",async a=>{await f(a)})});
